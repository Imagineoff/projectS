<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard bota</title>
<style>
  body { font-family: 'Segoe UI', sans-serif; background:#fff; color:#111; padding:2rem; transition: all 0.3s; }
  body.dark { background:#111; color:#f9f9f9; }
  h1 { margin-bottom:1rem; }
  #darkModeToggle { margin-bottom:1rem; cursor:pointer; padding:0.5rem 1rem; border:2px solid #111; background:none; border-radius:8px; }
  #darkModeToggle:hover { background:#111; color:#fff; }

  #serverList button { display:block; width:100%; padding:0.5rem; margin:0.5rem 0; border:1px solid #111; border-radius:8px; cursor:pointer; background:#f9f9f9; }
  #serverList button:hover { background:#111; color:#fff; }

  form { display:flex; flex-direction:column; gap:1rem; max-width:600px; margin-top:1rem; }
  textarea, select, input { font-size:1rem; padding:0.5rem; border-radius:8px; border:1px solid #111; width:100%; }
  button.save { background:#111; color:#fff; border:none; cursor:pointer; }
  button.save:hover { background:#333; }
</style>
</head>
<body>

<h1>Dashboard bota</h1>
<button id="darkModeToggle">🌙 Tmavý režim</button>

<div id="serverSelection">
  <h2>Vyber server:</h2>
  <div id="serverList"></div>
</div>

<div id="serverSettings" style="display:none;">
  <h2 id="serverName">Nastavení serveru</h2>
  <form id="settingsForm">
    <label>Styl odpovědi:</label>
    <select name="style">
      <option value="normal">Normální</option>
      <option value="funny">Vtipný</option>
      <option value="serious">Seriózní</option>
    </select>

    <label>Vlastní prompt:</label>
    <textarea name="prompt" rows="5" placeholder="Napiš, jak se má bot chovat..."></textarea>

    <label>ID kanálu, kam má bot reagovat:</label>
    <input type="text" name="channel" placeholder="ID kanálu">

    <button type="submit" class="save">Uložit nastavení</button>
  </form>
</div>

<script>
const toggle = document.getElementById("darkModeToggle");
toggle.addEventListener("click", () => document.body.classList.toggle("dark"));

// Dummy data pro servery (v reálu se načte z Discord API)
const userServers = [
  { id: "1111", name: "Server 1" },
  { id: "2222", name: "Server 2" },
  { id: "3333", name: "Server 3" }
];

const serverList = document.getElementById("serverList");
userServers.forEach(server => {
  const btn = document.createElement("button");
  btn.innerText = server.name;
  btn.onclick = () => selectServer(server);
  serverList.appendChild(btn);
});

let selectedServer = null;
function selectServer(server) {
  selectedServer = server;
  document.getElementById("serverSelection").style.display = "none";
  document.getElementById("serverSettings").style.display = "block";
  document.getElementById("serverName").innerText = `Nastavení pro: ${server.name}`;

  // TODO: načíst existující nastavení z backendu
}

document.getElementById("settingsForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const style = e.target.style.value;
  const prompt = e.target.prompt.value;
  const channel = e.target.channel.value;

  if (!selectedServer) return alert("Vyber server!");

  // Pošleme nastavení do Netlify function
  await fetch("/.netlify/functions/saveSettings", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      guild_id: selectedServer.id,
      style,
      prompt,
      channel
    })
  });

  alert("Nastavení uloženo!");
});
</script>

</body>
</html>
